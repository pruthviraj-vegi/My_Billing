{% extends "base.html" %}
{% load static %}
{% load custom_filters %}
{% block title %}
    Supplier Invoice Tracking
{% endblock title %}
{% block content %}
    <div class="page-header">
        <h2 class="page-title">Supplier Invoice Tracking</h2>
        <div class="page-actions">
            <button type="button"
                    class="btn btn-secondary"
                    onclick="reloadTable('supplierInvoiceTable')">
                <i class="fas fa-sync-alt"></i>
                Refresh
            </button>
        </div>
    </div>
    <nav class="breadcrumb breadcrumb-right">
        <a href="{% url 'inventory_products:home' %}" class="breadcrumb-item">Inventory</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-active">Supplier Invoices</span>
    </nav>
    <div class="search-filter-section">
        <form method="get"
              class="search-filter-form"
              id="searchForm"
              autocomplete="off">
            <div class="search-group search-expanded">
                <i class="fas fa-search search-icon"></i>
                <input type="search"
                       name="search"
                       class="search-input"
                       placeholder="Search invoices..."
                       value="{{ search_query }}"
                       id="searchInput">
            </div>
            <select name="supplier" class="filter-select" id="supplierFilter">
                <option value="">All Suppliers</option>
                {% for supplier in suppliers %}
                    <option value="{{ supplier.id }}"
                            {% if supplier_filter == supplier.id|stringformat:"s" %}selected{% endif %}>
                        {{ supplier.name }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i>
                Search
            </button>
        </form>
    </div>
    <div class="table-container">
        <table class="data-table"
               id="supplierInvoiceTable"
               data-sort="-invoice_date">
            <thead>
                <tr>
                    <th class="sortable" data-sort="invoice_number">Invoice Number</th>
                    <th class="sortable" data-sort="supplier_name">Supplier</th>
                    <th class="sortable" data-sort="invoice_date">Date</th>
                    <th class="sortable" data-sort="invoice_amount">Invoice Amount</th>
                    <th class="sortable" data-sort="stock_amount">Stock Amount</th>
                    <th class="sortable" data-sort="stock_in_quantity">Stock In</th>
                    <th class="sortable" data-sort="sales_quantity">Sales</th>
                    <th class="sortable" data-sort="remaining_quantity">Remaining</th>
                    <th class="sortable" data-sort="remaining_percentage">Sold %</th>
                    <th>Products</th>
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="11" class="text-center empty-state-container p-3">
                        <div class="empty-state">
                            <i class="fas fa-file-invoice"></i>
                            <h3>No Supplier Invoices Found</h3>
                            <p>No supplier invoices match your filters. Try adjusting the search criteria.</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
{% endblock content %}
{% block extra_js %}
    <script src="{% static 'js/fetchData.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const urls = {
                fetch: '{% url "inventory:supplier_invoice_tracking_fetch" %}',
            };

            initTableAjax('searchForm', 'supplierInvoiceTable', urls.fetch, {
                loadingText: 'Loading supplier invoices...',
                autoLoad: true,
            }, true);

            initTableSorting('supplierInvoiceTable');
        });
    </script>
{% endblock extra_js %}
