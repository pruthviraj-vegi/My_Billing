{% extends "base.html" %}
{% load static %}
{% load custom_filters %}
{% block title %}
  {{ supplier.name }} - Transaction Report
{% endblock title %}
{% block content %}
  <!-- Page Header -->
  <div class="page-header">
    <h2 class="page-title">
      <i class="fas fa-chart-line"></i>
      Transaction Report - {{ supplier.name }}
    </h2>
    <div class="page-actions">
      <a href="{% url 'supplier:detail' supplier.pk %}"
         class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i>
        Back to Details
      </a>
      <button class="btn btn-success" onclick="window.print()">
        <i class="fas fa-print"></i>
        Print Report
      </button>
      <button class="btn btn-info" onclick="exportToPDF()">
        <i class="fas fa-file-pdf"></i>
        Export PDF
      </button>
    </div>
  </div>
  <!-- Breadcrumb Navigation -->
  <nav class="breadcrumb breadcrumb-right">
    <a href="{% url 'base:home' %}" class="breadcrumb-item">Dashboard</a>
    <span class="breadcrumb-separator">/</span>
    <a href="{% url 'supplier:home' %}" class="breadcrumb-item">Suppliers</a>
    <span class="breadcrumb-separator">/</span>
    <a href="{% url 'supplier:detail' supplier.pk %}"
       class="breadcrumb-item">{{ supplier.name }}</a>
    <span class="breadcrumb-separator">/</span>
    <span class="breadcrumb-active">Report</span>
  </nav>
  <!-- Main Layout -->
  <div class="main-layout">
    <!-- Left Column - Supplier Details and Summary -->
    <div class="left-column">
      <!-- Supplier Details Column -->
      <div class="column supplier-details-column">
        <div class="column-header">
          <h3>
            <i class="fas fa-user"></i> Supplier Details
          </h3>
        </div>
        <div class="supplier-info-compact">
          <div class="supplier-name-compact">
            <h4>{{ supplier.name }}</h4>
            <span class="supplier-status {{ supplier.is_deleted|status_badge }}">{{ supplier.is_deleted|yesno:'Inactive,Active' }}</span>
          </div>
          <div class="supplier-contact-compact">
            <div class="contact-item">
              <i class="fas fa-phone"></i>
              <span>{{ supplier.phone }}</span>
            </div>
            {% if supplier.email %}
              <div class="contact-item">
                <i class="fas fa-envelope"></i>
                <span>{{ supplier.email }}</span>
              </div>
            {% endif %}
            {% if supplier.contact_person %}
              <div class="contact-item">
                <i class="fas fa-user"></i>
                <span>{{ supplier.contact_person }}</span>
              </div>
            {% endif %}
            {% if supplier.gstin %}
              <div class="contact-item">
                <i class="fas fa-id-card"></i>
                <span>{{ supplier.gstin }}</span>
              </div>
            {% endif %}
            {% if supplier.address %}
              <div class="contact-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ supplier.address|truncatechars:50 }}</span>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      <!-- Report Summary Cards -->
      <div class="summary-cards-compact">
        <div class="summary-card-compact">
          <div class="summary-icon-compact">
            <i class="fas fa-file-invoice"></i>
          </div>
          <div class="summary-content-compact">
            <h4>Total Invoiced</h4>
            <div class="summary-stats-compact">
              <div class="stat-item-compact">
                <span class="stat-number-compact">{{ total_invoiced|currency_nonDecimal }}</span>
                <span class="stat-label-compact">Amount</span>
              </div>
            </div>
          </div>
        </div>
        <div class="summary-card-compact">
          <div class="summary-icon-compact">
            <i class="fas fa-credit-card"></i>
          </div>
          <div class="summary-content-compact">
            <h4>Total Paid</h4>
            <div class="summary-stats-compact">
              <div class="stat-item-compact">
                <span class="stat-number-compact text-success">{{ total_paid|currency_nonDecimal }}</span>
                <span class="stat-label-compact">Amount</span>
              </div>
            </div>
          </div>
        </div>
        <div class="summary-card-compact">
          <div class="summary-icon-compact">
            <i class="fas fa-balance-scale"></i>
          </div>
          <div class="summary-content-compact">
            <h4>Outstanding Balance</h4>
            <div class="summary-stats-compact">
              <div class="stat-item-compact">
                <span class="stat-number-compact {% if outstanding_balance > 0 %}text-danger{% else %}text-success{% endif %}">
                  {{ outstanding_balance|currency_nonDecimal }}
                </span>
                <span class="stat-label-compact">Amount</span>
              </div>
            </div>
          </div>
        </div>
        <div class="summary-card-compact">
          <div class="summary-icon-compact">
            <i class="fas fa-list"></i>
          </div>
          <div class="summary-content-compact">
            <h4>Total Transactions</h4>
            <div class="summary-stats-compact">
              <div class="stat-item-compact">
                <span class="stat-number-compact">{{ transaction_count }}</span>
                <span class="stat-label-compact">Count</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Right Column - Transactions -->
    <div class="right-column">
      <!-- Simple Filter Section -->
      <div class="search-filter-section">
        <form method="get" class="search-filter-form">
          <div class="filter-group">
            <label for="start_date">Start Date:</label>
            <input type="date"
                   id="start_date"
                   name="start_date"
                   value="{{ start_date|date:'Y-m-d' }}"
                   class="form-control" />
          </div>
          <div class="filter-group">
            <label for="end_date">End Date:</label>
            <input type="date"
                   id="end_date"
                   name="end_date"
                   value="{{ end_date|date:'Y-m-d' }}"
                   class="form-control" />
          </div>
          <div class="filter-group">
            <label for="view_type">View Type:</label>
            <select name="view" id="view_type" class="filter-select">
              <option value="timeline" {% if view_type == 'timeline' %}selected{% endif %}>Timeline View</option>
              <option value="table" {% if view_type == 'table' %}selected{% endif %}>Table View</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-filter"></i>
            Apply Filter
          </button>
          <a href="{% url 'supplier:report' supplier.pk %}"
             class="btn btn-secondary">
            <i class="fas fa-times"></i>
            Clear
          </a>
        </form>
      </div>
      {% if view_type == 'timeline' %}
        <!-- Transactions Timeline -->
        <div class="table-section" id="timelineSection">
          <div class="table-header">
            <h3>
              <i class="fas fa-history"></i> Transaction History (Timeline)
            </h3>
            <div class="table-stats">
              <span class="stat-item">
                <i class="fas fa-file-invoice text-primary"></i>
                {{ transactions|length }} transactions
              </span>
            </div>
          </div>
          {% if transactions %}
            <div class="timeline-container">
              {% for transaction in transactions %}
                <div class="timeline-item {% if transaction.type == 'invoice' %}invoice-item{% else %}payment-item{% endif %}">
                  <div class="timeline-marker">
                    {% if transaction.type == 'invoice' %}
                      <i class="fas fa-file-invoice"></i>
                    {% else %}
                      <i class="fas fa-credit-card"></i>
                    {% endif %}
                  </div>
                  <div class="timeline-content">
                    <div class="timeline-header">
                      <div class="transaction-info">
                        <h4>{{ transaction.description }}</h4>
                        <span class="transaction-date">{{ transaction.date|date:'M j, Y' }}</span>
                      </div>
                      <div class="transaction-amount">
                        {% if transaction.type == 'invoice' %}
                          <span class="amount-invoice">+{{ transaction.amount|currency }}</span>
                        {% else %}
                          <span class="amount-payment">-{{ transaction.amount|currency }}</span>
                        {% endif %}
                      </div>
                    </div>
                    <div class="timeline-details">
                      <div class="detail-row">
                        <div class="detail-item">
                          <strong>Type:</strong>
                          <span class="badge {% if transaction.type == 'invoice' %}badge-primary{% else %}badge-success{% endif %}">
                            {% if transaction.type == 'invoice' %}
                              Purchase Invoice
                            {% else %}
                              Payment
                            {% endif %}
                          </span>
                        </div>
                        <div class="detail-item">
                          <strong>Reference:</strong>
                          <span>{{ transaction.reference|default:'-' }}</span>
                        </div>
                        {% if transaction.type == 'payment' and transaction.method %}
                          <div class="detail-item">
                            <strong>Method:</strong>
                            <span class="badge badge-info">{{ transaction.object.get_method_display }}</span>
                          </div>
                        {% endif %}
                        {% if transaction.type == 'invoice' %}
                          <div class="detail-item">
                            <strong>Status:</strong>
                            <span class="status-badge {% if transaction.status == 'PAID' %}status-active {% elif transaction.status == 'PARTIALLY_PAID' %}status-warning {% else %}status-danger{% endif %}">
                              {{ transaction.object.get_status_display }}
                            </span>
                          </div>
                        {% endif %}
                      </div>
                      {% if transaction.type == 'invoice' %}
                        <div class="invoice-breakdown">
                          <div class="breakdown-item">
                            <span class="label">Sub Total:</span>
                            <span class="value">{{ transaction.sub_total|currency }}</span>
                          </div>
                          {% if transaction.gst_type == 'CGST_SGST' %}
                            <div class="breakdown-item">
                              <span class="label">CGST:</span>
                              <span class="value">{{ transaction.cgst_amount|currency }}</span>
                            </div>
                            <div class="breakdown-item">
                              <span class="label">SGST:</span>
                              <span class="value">{{ transaction.cgst_amount|currency }}</span>
                            </div>
                          {% elif transaction.gst_type == 'IGST' %}
                            <div class="breakdown-item">
                              <span class="label">IGST:</span>
                              <span class="value">{{ transaction.igst_amount|currency }}</span>
                            </div>
                          {% endif %}
                          {% if transaction.adjustment_amount != 0 %}
                            <div class="breakdown-item">
                              <span class="label">Adjustment:</span>
                              <span class="value">{{ transaction.adjustment_amount|currency }}</span>
                            </div>
                          {% endif %}
                          {% if transaction.paid_amount > 0 %}
                            <div class="breakdown-item">
                              <span class="label">Paid Amount:</span>
                              <span class="value text-success">{{ transaction.paid_amount|currency }}</span>
                            </div>
                          {% endif %}
                        </div>
                      {% endif %}
                      {% if transaction.type == 'payment' and transaction.unallocated_amount > 0 %}
                        <div class="payment-breakdown">
                          <div class="breakdown-item">
                            <span class="label">Unallocated:</span>
                            <span class="value text-warning">{{ transaction.unallocated_amount|currency }}</span>
                          </div>
                        </div>
                      {% endif %}
                      {% if transaction.notes %}
                        <div class="transaction-notes">
                          <strong>Notes:</strong>
                          <p>{{ transaction.notes }}</p>
                        </div>
                      {% endif %}
                    </div>
                    <div class="timeline-footer">
                      <div class="running-balance">
                        <strong>Running Balance:</strong>
                        <span class="balance-amount {% if transaction.running_balance > 0 %}text-danger{% else %}text-success{% endif %}">
                          {{ transaction.running_balance|currency }}
                        </span>
                      </div>
                      <div class="transaction-actions">
                        {% if transaction.type == 'invoice' %}
                          <a href="{% url 'supplier:edit_invoice' supplier.pk transaction.object.pk %}"
                             class="btn-action btn-edit"
                             title="Edit Invoice">
                            <i class="fas fa-edit"></i>
                          </a>
                        {% else %}
                          <a href="{% url 'supplier:edit_payment' supplier.pk transaction.object.pk %}"
                             class="btn-action btn-edit"
                             title="Edit Payment">
                            <i class="fas fa-edit"></i>
                          </a>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="empty-state">
              <i class="fas fa-chart-line"></i>
              <h4>No Transactions Found</h4>
              <p>No transactions have been recorded for this supplier in the selected date range.</p>
              {% if start_date or end_date %}
                <a href="{% url 'supplier:report' supplier.pk %}"
                   class="btn btn-primary">
                  <i class="fas fa-times"></i>
                  Clear Date Filter
                </a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      {% else %}
        <!-- Transactions Table -->
        <div class="table-section" id="tableSection">
          <div class="table-header">
            <h3>
              <i class="fas fa-table"></i> Transaction History (Table)
            </h3>
            <div class="table-stats">
              <span class="stat-item">
                <i class="fas fa-file-invoice text-primary"></i>
                {{ transactions|length }} transactions
              </span>
            </div>
          </div>
          {% if transactions %}
            <div class="table-container">
              <table class="data-table report-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Reference</th>
                    <th>Description</th>
                    <th>Sub Total</th>
                    <th>GST</th>
                    <th>Adjustment</th>
                    <th>Total Amount</th>
                    <th>Status/Method</th>
                    <th>Running Balance</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  {% for transaction in transactions %}
                    <tr class="{% if transaction.type == 'invoice' %}invoice-row{% else %}payment-row{% endif %}">
                      <td>{{ transaction.date|date:'M j, Y' }}</td>
                      <td>
                        <span class="badge {% if transaction.type == 'invoice' %}badge-primary{% else %}badge-success{% endif %}">
                          {% if transaction.type == 'invoice' %}
                            Invoice
                          {% else %}
                            Payment
                          {% endif %}
                        </span>
                      </td>
                      <td>{{ transaction.reference|default:'-' }}</td>
                      <td>
                        <strong>{{ transaction.description }}</strong>
                        {% if transaction.type == 'payment' and transaction.unallocated_amount > 0 %}
                          <br>
                          <small class="text-warning">Unallocated: {{ transaction.unallocated_amount|currency }}</small>
                        {% endif %}
                      </td>
                      <td>
                        {% if transaction.type == 'invoice' %}
                          {{ transaction.sub_total|currency }}
                        {% else %}
                          -
                        {% endif %}
                      </td>
                      <td>
                        {% if transaction.type == 'invoice' %}
                          {% if transaction.gst_type == 'CGST_SGST' %}
                            CGST: {{ transaction.cgst_amount|currency }}
                            <br>
                            SGST: {{ transaction.cgst_amount|currency }}
                          {% elif transaction.gst_type == 'IGST' %}
                            IGST: {{ transaction.igst_amount|currency }}
                          {% else %}
                            -
                          {% endif %}
                        {% else %}
                          -
                        {% endif %}
                      </td>
                      <td>
                        {% if transaction.type == 'invoice' and transaction.adjustment_amount != 0 %}
                          {{ transaction.adjustment_amount|currency }}
                        {% else %}
                          -
                        {% endif %}
                      </td>
                      <td>
                        <strong class="{% if transaction.type == 'invoice' %}text-danger{% else %}text-success{% endif %}">
                          {% if transaction.type == 'invoice' %}
                            +
                          {% else %}
                            -
                          {% endif %}
                          {{ transaction.amount|currency }}
                        </strong>
                        {% if transaction.type == 'invoice' and transaction.paid_amount > 0 %}
                          <br>
                          <small class="text-success">Paid: {{ transaction.paid_amount|currency }}</small>
                        {% endif %}
                      </td>
                      <td>
                        {% if transaction.type == 'invoice' %}
                          <span class="status-badge {% if transaction.status == 'PAID' %}status-active {% elif transaction.status == 'PARTIALLY_PAID' %}status-warning {% else %}status-danger{% endif %}">
                            {{ transaction.object.get_status_display }}
                          </span>
                        {% else %}
                          <span class="badge badge-info">{{ transaction.object.get_method_display }}</span>
                        {% endif %}
                      </td>
                      <td>
                        <strong class="{% if transaction.running_balance > 0 %}text-danger{% else %}text-success{% endif %}">
                          {{ transaction.running_balance|currency }}
                        </strong>
                      </td>
                      <td>
                        {% if transaction.notes %}
                          <span class="notes-text" title="{{ transaction.notes }}">{{ transaction.notes|truncatechars:30 }}</span>
                        {% else %}
                          -
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="empty-state">
              <i class="fas fa-table"></i>
              <h4>No Transactions Found</h4>
              <p>No transactions have been recorded for this supplier in the selected date range.</p>
              {% if start_date or end_date %}
                <a href="{% url 'supplier:report' supplier.pk %}?view=table"
                   class="btn btn-primary">
                  <i class="fas fa-times"></i>
                  Clear Date Filter
                </a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
{% endblock content %}
{% block extra_css %}
  <style>
    .main-layout {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 2rem;
      margin-top: 2rem;
    }
    
    .left-column {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    
    .column {
      background: var(--bg-surface);
      border-radius: 8px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }
    
    .column-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-surface-hover);
      border-radius: 8px 8px 0 0;
    }
    
    .column-header h3 {
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-primary);
      font-size: 1.1rem;
    }
    
    .supplier-info-compact {
      padding: 1.5rem;
    }
    
    .supplier-name-compact {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .supplier-name-compact h4 {
      margin: 0;
      color: var(--text-primary);
      font-size: 1.2rem;
    }
    
    .supplier-status {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .supplier-contact-compact {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .contact-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--text-secondary);
    }
    
    .contact-item i {
      width: 16px;
      color: var(--primary);
    }
    
    .summary-cards-compact {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .summary-card-compact {
      background: var(--bg-surface);
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .summary-icon-compact {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
    }
    
    .summary-card-compact:nth-child(1) .summary-icon-compact {
      background: #007bff;
    }
    .summary-card-compact:nth-child(2) .summary-icon-compact {
      background: #28a745;
    }
    .summary-card-compact:nth-child(3) .summary-icon-compact {
      background: #ffc107;
    }
    .summary-card-compact:nth-child(4) .summary-icon-compact {
      background: #6c757d;
    }
    
    .summary-content-compact h4 {
      margin: 0 0 0.5rem 0;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .summary-stats-compact {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .stat-item-compact {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .stat-number-compact {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--text-primary);
    }
    
    .stat-label-compact {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    
    /* Simple Filter Section Styles - Matching home.html */
    .search-filter-section {
      background: var(--bg-surface);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }
    
    .search-filter-form {
      display: flex;
      gap: 1rem;
      align-items: end;
      flex-wrap: wrap;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .filter-group label {
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.9rem;
    }
    
    .form-control {
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 0.9rem;
      background: white;
      transition: border-color 0.2s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
    }
    
    .filter-select {
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 0.9rem;
      background: white;
      cursor: pointer;
      transition: border-color 0.2s ease;
    }
    
    .filter-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
    }
    
    .table-section {
      background: var(--bg-surface);
      border-radius: 8px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }
    
    .table-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--bg-surface-hover);
      border-radius: 8px 8px 0 0;
    }
    
    .table-header h3 {
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-primary);
    }
    
    .table-stats {
      display: flex;
      gap: 1rem;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .timeline-container {
      padding: 1rem;
    }
    
    .timeline-item {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      position: relative;
    }
    
    .timeline-item:not(:last-child)::after {
      content: '';
      position: absolute;
      left: 25px;
      top: 50px;
      bottom: -2rem;
      width: 2px;
      background: var(--border-color);
    }
    
    .timeline-marker {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: white;
      flex-shrink: 0;
    }
    
    .invoice-item .timeline-marker {
      background: var(--primary);
    }
    
    .payment-item .timeline-marker {
      background: var(--success);
    }
    
    .timeline-content {
      flex: 1;
      background: var(--bg-surface-hover);
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }
    
    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }
    
    .transaction-info h4 {
      margin: 0 0 0.25rem 0;
      color: var(--text-primary);
    }
    
    .transaction-date {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .transaction-amount {
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    .amount-invoice {
      color: #dc3545;
    }
    
    .amount-payment {
      color: #28a745;
    }
    
    .timeline-details {
      margin-bottom: 1rem;
    }
    
    .detail-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .detail-item strong {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .invoice-breakdown,
    .payment-breakdown {
      background: var(--bg-surface);
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
      border: 1px solid var(--border-color);
    }
    
    .breakdown-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    
    .breakdown-item:last-child {
      margin-bottom: 0;
    }
    
    .breakdown-item .label {
      font-weight: 500;
      color: var(--text-secondary);
    }
    
    .transaction-notes {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--bg-surface);
      border-radius: 6px;
      border-left: 4px solid var(--primary);
    }
    
    .transaction-notes p {
      margin: 0.5rem 0 0 0;
      color: var(--text-secondary);
    }
    
    .timeline-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
    }
    
    .running-balance {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .balance-amount {
      font-weight: bold;
      font-size: 1.1rem;
    }
    
    .transaction-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .btn-action {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: white;
      font-size: 0.9rem;
    }
    
    .btn-edit {
      background: var(--primary);
    }
    
    .btn-edit:hover {
      background: var(--primary-hover);
    }
    
    .report-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    
    .report-table th {
      background: var(--bg-surface-hover);
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid var(--border-color);
      color: var(--text-primary);
    }
    
    .report-table td {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border-color);
      vertical-align: top;
      color: var(--text-primary);
    }
    
    .report-table tbody tr:hover {
      background: var(--bg-surface-hover);
    }
    
    .invoice-row {
      background: rgba(220, 53, 69, 0.05);
    }
    
    .payment-row {
      background: rgba(40, 167, 69, 0.05);
    }
    
    .invoice-row:hover {
      background: rgba(220, 53, 69, 0.1) !important;
    }
    
    .payment-row:hover {
      background: rgba(40, 167, 69, 0.1) !important;
    }
    
    .notes-text {
      cursor: help;
      border-bottom: 1px dotted var(--text-secondary);
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--border-color);
    }
    
    .text-danger {
      color: var(--danger) !important;
    }
    
    .text-success {
      color: var(--success) !important;
    }
    
    .text-warning {
      color: var(--warning) !important;
    }
    
    @media (max-width: 1200px) {
      .main-layout {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .left-column {
        order: 2;
      }
      
      .right-column {
        order: 1;
      }
      
      .search-filter-form {
        flex-direction: column;
        align-items: stretch;
      }
    }
    
    @media print {
      .page-actions,
      .search-filter-section,
      .transaction-actions {
        display: none !important;
      }
      
      .timeline-content {
        box-shadow: none;
        border: 1px solid var(--border-color);
      }
      
      .report-table {
        font-size: 0.8rem;
      }
      
      .report-table th,
      .report-table td {
        padding: 0.5rem;
      }
      
      .main-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
{% endblock extra_css %}
{% block extra_js %}
  <script>
    function exportToPDF() {
      // This would integrate with a PDF library like jsPDF
      alert('PDF export functionality will be implemented here.')
    }
    
    // Auto-submit form when date inputs or view type changes
    document.addEventListener('DOMContentLoaded', function () {
      const startDate = document.getElementById('start_date')
      const endDate = document.getElementById('end_date')
      const viewType = document.getElementById('view_type')
    
      function submitForm() {
        document.querySelector('.search-filter-form').submit()
      }
    
      startDate.addEventListener('change', submitForm)
      endDate.addEventListener('change', submitForm)
      viewType.addEventListener('change', submitForm)
    })
  </script>
{% endblock extra_js %}
